<template>
  <div class="vulnerabilityDetails">
    <a-row
      :gutter="[
        { xs: 8, sm: 16, md: 24, xs: 8 },
        { xs: 4, sm: 4, md: 8, lg: 8 },
      ]"
      type="flex"
      justify="center"
      align="middle"
    >
      <a-col
        :xs="{ span: 24 }"
        :sm="{ span: 16 }"
        :md="{ span: 12 }"
        :lg="{ span: 6 }"
        class="vulnerabilityDetails_main"
      >
        <personalCard :LV="LV">
          <!--èƒŒé¢-->
          <div slot="title" class="title"><span>éšç§ä¿¡æ¯</span></div>
          <div slot="main">
            <a-col :xs="{ span: 24 }">
              <a-col :xs="{ span: 24 }"> ç‰¹é•¿: </a-col>
              <a-col :xs="{ span: 24 }" class="title_overflow format">
                {{ vulnerabilityList.details }}
              </a-col>
            </a-col>
            <a-col :xs="{ span: 24 }">
              <a-col :xs="{ span: 24 }"> ç”Ÿå¹³äº‹è¿¹: </a-col>
              <a-col :xs="{ span: 24 }" class="title_overflow format">
                {{ vulnerabilityList.desc_content }}
              </a-col>
            </a-col>
            <a-col :xs="{ span: 24 }">
              <a-col :xs="{ span: 24 }"> å¼±ç‚¹: </a-col>
              <a-col :xs="{ span: 24 }" class="title_overflow format">
                {{ vulnerabilityList.suggest }}
              </a-col>
            </a-col>
          </div>
          <!--æ­£é¢-->
          <div slot="title_back" class="title_back">
            {{ vulnerabilityList.name }}
          </div>

          <div slot="main_back">
            <a-col :xs="{ span: 24 }" style="margin-top: 5px">
              <span>èº«ä»½ID:</span
              ><span class="format">{{ vulnerabilityList.scan_info_id }}</span>
            </a-col>
            <a-col :xs="{ span: 24 }" style="margin-top: 5px">
              <span>ç±è´¯:</span
              ><span class="format">{{ vulnerabilityList.url }}</span>
            </a-col>
            <a-col :xs="{ span: 24 }" style="margin-top: 5px">
              <span>English Name:</span
              ><span class="format">{{ vulnerabilityList.algroup }}</span>
            </a-col>
            <a-col :xs="{ span: 24 }" style="margin-top: 5px">
              <span>å¹´é¾„:</span
              ><span class="format">{{ vulnerabilityList.timestamp }}</span>
            </a-col>
            <a-col :xs="{ span: 24 }" style="margin-top: 5px">
              <span>çˆ¶äº²ID:</span
              ><span class="format">{{
                vulnerabilityList.active_scan_id
              }}</span>
            </a-col>
            <a-col :xs="{ span: 24 }" style="margin-top: 5px">
              <span>æ¼æ´ç»„ä»¶:</span
              ><span class="format">{{ vulnerabilityList.affects }}</span>
            </a-col>
            <a-col :xs="{ span: 24 }" style="margin-top: 5px">
              <span>ç‰ˆæœ¬:</span
              ><span class="format">{{ vulnerabilityList.version }}</span>
            </a-col>
            <a-col :xs="{ span: 24 }" style="margin-top: 5px">
              <span>ç¨€æœ‰åº¦:</span
              ><span class="format rank">{{ vulnerabilityList.rank }}</span>
            </a-col>
          </div>
        </personalCard>
      </a-col>
    </a-row>
  </div>
</template>

<script>
import personalCard from "../../../../components/personalCard";
export default {
  name: "vulnerabilityDetails",
  components: {
    personalCard,
  },
  data() {
    return {
      vulnerabilityList: {},
      LV: "",
    };
  },
  mounted() {
    this.handleGetmedusa_query();
  },
  methods: {
    handleGetmedusa_query() {
      if (this.$store.state.scan_info_id != "null") {
        let params = {
          token: localStorage.getItem("storeToken"),
          scan_info_id: this.$store.state.scan_info_id,
        };
        this.$api.medusa_query(params).then((res) => {
          switch (res.code) {
            case 200:
              res.message.map((item) => {
                this.vulnerabilityList = {
                  name: item.name, //æ¼æ´åå­—
                  active_scan_id: item.active_scan_id, //ä¸Šçº§id
                  scan_info_id: item.scan_info_id, //å•å‰id
                  affects: item.affects, //æ¼æ´ç»„ä»¶
                  algroup: item.algroup, //è‹±æ–‡å
                  desc_content: item.desc_content, //æ¼æ´æè¿°
                  details: item.details, //æ¼æ´è¯¦æƒ…
                  rank: this.handleReturnSSR(item.rank), //æ¼æ´ç­‰çº§
                  url: item.url, //ç›®æ ‡åœ°å€
                  version: item.version, //ç‰ˆæœ¬
                  timestamp: item.timestamp, //æ‰«æåˆ°çš„æ—¶é—´
                  suggest: item.suggest, //ä¿®å¤å»ºè®®
                };
                this.LV = this.handleReturnSSR(item.rank);
              });
              break;
            case 404:
              this.$message.error("æ•°æ®åº“GGäº†ğŸˆ");
              break;
            case 403:
              this.$message.error("å°å®è´è¿™æ˜¯éæ³•æŸ¥è¯¢å“¦(à¹‘â€¢Ì€ã…‚â€¢Ì)Ùˆâœ§");
              break;
            case 169:
              this.$message.error("èé…±è¢«ç©åå•¦(>^Ï‰^<)å–µ");
              break;
            case 500:
              this.$message.error("è¯·ä½¿ç”¨Postè¯·æ±‚");
              break;
          }
        });
      } else if(this.$store.state.active_scan_id != "null"){
          this.$message.warning("è¯·ä»æ¼æ´åˆ—è¡¨æŸ¥è¯¢è¿›å…¥,è·³è½¬æ¼æ´åˆ—è¡¨æŸ¥è¯¢ä¸­...");
        this.$router.push("/layout/siteInformation/siteScan");
        }else{
        this.$message.warning("è¯·ä»ç«™ç‚¹æ‰«æè¿›å…¥,è·³è½¬ç«™ç‚¹æ‰«æä¸­...");
        this.$router.push("/layout/siteInformation");
      }
    },
    handleReturnSSR(e) {
      switch (e) {
        case "é«˜å±":
          return "SSR";
          break;
        case "ä¸­å±":
          return "SR";
          break;
        case "ä½å±":
          return "UR";
          break;
      }
    },
  },
};
</script>

<style lang="scss" scoped>
.vulnerabilityDetails {
  height: 100%;
  margin: 0;
  padding: 20px;
  padding-top: 15px;

  .vulnerabilityDetails_main {
    margin-top: 50px;
    height: 600px;
    border-radius: 15px;
    color: #fff;

    .title_back {
      text-align: center;
    }

    .title {
      text-align: center;
    }
  }
}

.title_overflow {
  overflow: auto;
  min-height: 100px;
  max-height: 155px;
}

/*å®šä¹‰æ•´ä½“çš„å®½åº¦*/
.title_overflow::-webkit-scrollbar {
  width: 3px;
}

/*å®šä¹‰æ»šåŠ¨æ¡è½¨é“*/
.title_overflow::-webkit-scrollbar-track {
  border-radius: 5px;
}

/*å®šä¹‰æ»‘å—*/
.title_overflow::-webkit-scrollbar-thumb {
  border-radius: 5px;
  background: rgba(255, 255, 255, 0.5);
}

.format {
  word-break: break-all;
}

.rank {
  margin-left: 20px;
  font-size: 32px;
  font-weight: 800;
  line-height: 64px;
  background: -webkit-linear-gradient(
    #ec5f67,
    #f99157,
    #fac863 20%,
    #99c794 40%,
    #5fb3b3 60%,
    #6699cc 80%,
    #c594c5
  );
  color: transparent;
  -webkit-background-clip: text;
}
</style>

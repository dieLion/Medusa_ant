<template>
  <div class="vulnerabilityDetails">
    <a-row
      :gutter="[
        { xs: 8, sm: 16, md: 24, xs: 8 },
        { xs: 4, sm: 4, md: 8, lg: 8 },
      ]"
      type="flex"
      justify="center"
      align="middle"
    >
      <a-col
        :xs="{ span: 24 }"
        :sm="{ span: 16 }"
        :md="{ span: 12 }"
        :lg="{ span: 6 }"
        class="vulnerabilityDetails_main"
      >
        <personalCard :LV="LV">
          <!--背面-->
          <div slot="title" class="title"><span>隐私信息</span></div>
          <div slot="main">
            <a-col :xs="{ span: 24 }">
              <a-col :xs="{ span: 24 }"> 特长: </a-col>
              <a-col :xs="{ span: 24 }" class="title_overflow format">
                {{ vulnerabilityList.details }}
              </a-col>
            </a-col>
            <a-col :xs="{ span: 24 }">
              <a-col :xs="{ span: 24 }"> 生平事迹: </a-col>
              <a-col :xs="{ span: 24 }" class="title_overflow format">
                {{ vulnerabilityList.desc_content }}
              </a-col>
            </a-col>
            <a-col :xs="{ span: 24 }">
              <a-col :xs="{ span: 24 }"> 弱点: </a-col>
              <a-col :xs="{ span: 24 }" class="title_overflow format">
                {{ vulnerabilityList.suggest }}
              </a-col>
            </a-col>
          </div>
          <!--正面-->
          <div slot="title_back" class="title_back">
            {{ vulnerabilityList.name }}
          </div>

          <div slot="main_back">
            <a-col :xs="{ span: 24 }" style="margin-top: 5px">
              <span>身份ID:</span
              ><span class="format">{{ vulnerabilityList.scan_info_id }}</span>
            </a-col>
            <a-col :xs="{ span: 24 }" style="margin-top: 5px">
              <span>籍贯:</span
              ><span class="format">{{ vulnerabilityList.url }}</span>
            </a-col>
            <a-col :xs="{ span: 24 }" style="margin-top: 5px">
              <span>English Name:</span
              ><span class="format">{{ vulnerabilityList.algroup }}</span>
            </a-col>
            <a-col :xs="{ span: 24 }" style="margin-top: 5px">
              <span>年龄:</span
              ><span class="format">{{ vulnerabilityList.timestamp }}</span>
            </a-col>
            <a-col :xs="{ span: 24 }" style="margin-top: 5px">
              <span>父亲ID:</span
              ><span class="format">{{
                vulnerabilityList.active_scan_id
              }}</span>
            </a-col>
            <a-col :xs="{ span: 24 }" style="margin-top: 5px">
              <span>漏洞组件:</span
              ><span class="format">{{ vulnerabilityList.affects }}</span>
            </a-col>
            <a-col :xs="{ span: 24 }" style="margin-top: 5px">
              <span>版本:</span
              ><span class="format">{{ vulnerabilityList.version }}</span>
            </a-col>
            <a-col :xs="{ span: 24 }" style="margin-top: 5px">
              <span>稀有度:</span
              ><span class="format rank">{{ vulnerabilityList.rank }}</span>
            </a-col>
          </div>
        </personalCard>
      </a-col>
    </a-row>
  </div>
</template>

<script>
import personalCard from "../../../../components/personalCard";
export default {
  name: "vulnerabilityDetails",
  components: {
    personalCard,
  },
  data() {
    return {
      vulnerabilityList: {},
      LV: "",
    };
  },
  mounted() {
    this.handleGetmedusa_query();
  },
  methods: {
    handleGetmedusa_query() {
      if (this.$store.state.scan_info_id != "null") {
        let params = {
          token: localStorage.getItem("storeToken"),
          scan_info_id: this.$store.state.scan_info_id,
        };
        this.$api.medusa_query(params).then((res) => {
          switch (res.code) {
            case 200:
              res.message.map((item) => {
                this.vulnerabilityList = {
                  name: item.name, //漏洞名字
                  active_scan_id: item.active_scan_id, //上级id
                  scan_info_id: item.scan_info_id, //单前id
                  affects: item.affects, //漏洞组件
                  algroup: item.algroup, //英文名
                  desc_content: item.desc_content, //漏洞描述
                  details: item.details, //漏洞详情
                  rank: this.handleReturnSSR(item.rank), //漏洞等级
                  url: item.url, //目标地址
                  version: item.version, //版本
                  timestamp: item.timestamp, //扫描到的时间
                  suggest: item.suggest, //修复建议
                };
                this.LV = this.handleReturnSSR(item.rank);
              });
              break;
            case 404:
              this.$message.error("数据库GG了🐈");
              break;
            case 403:
              this.$message.error("小宝贝这是非法查询哦(๑•̀ㅂ•́)و✧");
              break;
            case 169:
              this.$message.error("莎酱被玩坏啦(>^ω^<)喵");
              break;
            case 500:
              this.$message.error("请使用Post请求");
              break;
          }
        });
      } else if(this.$store.state.active_scan_id != "null"){
          this.$message.warning("请从漏洞列表查询进入,跳转漏洞列表查询中...");
        this.$router.push("/layout/siteInformation/siteScan");
        }else{
        this.$message.warning("请从站点扫描进入,跳转站点扫描中...");
        this.$router.push("/layout/siteInformation");
      }
    },
    handleReturnSSR(e) {
      switch (e) {
        case "高危":
          return "SSR";
          break;
        case "中危":
          return "SR";
          break;
        case "低危":
          return "UR";
          break;
      }
    },
  },
};
</script>

<style lang="scss" scoped>
.vulnerabilityDetails {
  height: 100%;
  margin: 0;
  padding: 20px;
  padding-top: 15px;

  .vulnerabilityDetails_main {
    margin-top: 50px;
    height: 600px;
    border-radius: 15px;
    color: #fff;

    .title_back {
      text-align: center;
    }

    .title {
      text-align: center;
    }
  }
}

.title_overflow {
  overflow: auto;
  min-height: 100px;
  max-height: 155px;
}

/*定义整体的宽度*/
.title_overflow::-webkit-scrollbar {
  width: 3px;
}

/*定义滚动条轨道*/
.title_overflow::-webkit-scrollbar-track {
  border-radius: 5px;
}

/*定义滑块*/
.title_overflow::-webkit-scrollbar-thumb {
  border-radius: 5px;
  background: rgba(255, 255, 255, 0.5);
}

.format {
  word-break: break-all;
}

.rank {
  margin-left: 20px;
  font-size: 32px;
  font-weight: 800;
  line-height: 64px;
  background: -webkit-linear-gradient(
    #ec5f67,
    #f99157,
    #fac863 20%,
    #99c794 40%,
    #5fb3b3 60%,
    #6699cc 80%,
    #c594c5
  );
  color: transparent;
  -webkit-background-clip: text;
}
</style>

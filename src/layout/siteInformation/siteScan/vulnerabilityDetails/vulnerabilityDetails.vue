<template>
<div class="vulnerabilityDetails">
    <a-row :gutter="[
        { xs: 8, sm: 16, md: 24, xs: 8 },
        { xs: 4, sm: 8, md: 16, lg: 24 },
      ]">
        <a-col :xs="{ span: 24 }" :lg="{ span: 24 }">
            <!-- <a-col :xs="{ span: 24 }" :lg="{ span: 24 }" class="vulnerabilityDetails-title">漏洞详情:</a-col>-->
            <a-col :xs="{ span: 24 }" :lg="{ span: 24 }" class="vulnerabilityDetails-nav">
                <a-col :xs="{ span: 24 }" :lg="{ span: 24 }" class="vulnerabilityDetails-nav-name">
                    基础信息
                </a-col>
                <a-col :xs="{ span: 24 }" :lg="{ span: 24 }" class="vulnerabilityDetails-nav-best">
                    <a-col :xs="{ span: 8 }" style="margin-top: 5px">
                        <span>漏洞名:</span><span class="format">{{ vulnerabilityList.name }}</span>
                    </a-col>
                    <a-col :xs="{ span: 8 }" style="margin-top: 5px">
                        <span>ID:</span><span class="format">{{ vulnerabilityList.scan_info_id }}</span>
                    </a-col>
                    <a-col :xs="{ span: 8 }" style="margin-top: 5px">
                        <span>上级ID:</span><span class="format">{{
                vulnerabilityList.active_scan_id
              }}</span>
                    </a-col>
                    <a-col :xs="{ span: 8 }" style="margin-top: 5px">
                        <span>URL:</span><span class="format">{{ vulnerabilityList.url }}</span>
                    </a-col>
                    <a-col :xs="{ span: 8 }" style="margin-top: 5px">
                        <span>漏洞组件:</span><span class="format">{{ vulnerabilityList.affects }}</span>
                    </a-col>
                    <a-col :xs="{ span: 8 }" style="margin-top: 5px">
                        <span>扫描到的时间:</span><span class="format">{{ vulnerabilityList.timestamp }}</span>
                    </a-col>
                    <a-col :xs="{ span: 8 }" style="margin-top: 5px">
                        <span>漏洞等级:</span><span class="format" :class="LV">{{
                vulnerabilityList.rank
              }}</span>
                    </a-col>
                    <a-col :xs="{ span: 24 }" style="margin-top: 5px">
                        <span>版本:</span><span class="format">{{ vulnerabilityList.version }}</span>
                    </a-col>
                </a-col>
            </a-col>
            <a-col :xs="{ span: 24 }" :lg="{ span: 24 }" class="vulnerabilityDetails-nav">
                <a-col :xs="{ span: 24 }" :lg="{ span: 24 }" class="vulnerabilityDetails-nav-name">
                    详细信息
                </a-col>
                <a-col :xs="{ span: 24 }" :lg="{ span: 24 }" class="vulnerabilityDetails-nav-solution">
                    <a-col :xs="{ span: 24 }" style="margin-top: 5px">
                        <div class="class_title">漏洞描述:</div>
                        <div class="format">{{ vulnerabilityList.desc_content }}</div>
                    </a-col>
                    <a-col :xs="{ span: 24 }" style="margin-top: 5px">
                        <div class="class_title">漏洞详情:</div>
                        <div class="format">{{ vulnerabilityList.details }}</div>
                    </a-col>
                    <a-col :xs="{ span: 24 }" style="margin-top: 5px">
                        <div class="class_title">修复建议:</div>
                        <div class="format">{{ vulnerabilityList.suggest }}</div>
                    </a-col>
                </a-col>
            </a-col>
        </a-col>
    </a-row>
</div>
</template>

<script>
export default {
    name: "vulnerabilityDetails",
    data() {
        return {
            vulnerabilityList: {},
            LV: "",
        };
    },
    mounted() {
        this.handleGetmedusa_query();
    },
    methods: {
        handleReturnSSR(e) {
            switch (e) {
                case "高危":
                    return "SSR";
                    break;
                case "中危":
                    return "SR";
                    break;
                case "低危":
                    return "UR";
                    break;
            }
        },
        handleGetmedusa_query() {
            if (this.$store.state.scan_info_id != "null") {
                let params = {
                    token: localStorage.getItem("storeToken"),
                    scan_info_id: this.$store.state.scan_info_id,
                };
                this.$api.medusa_query(params).then((res) => {
                    switch (res.code) {
                        case 200:
                            res.message.map((item) => {
                                this.vulnerabilityList = {
                                    name: item.name, //漏洞名字
                                    active_scan_id: item.active_scan_id, //上级id
                                    scan_info_id: item.scan_info_id, //单前id
                                    affects: item.affects, //漏洞组件
                                    algroup: item.algroup, //英文名
                                    desc_content: item.desc_content, //漏洞描述
                                    details: item.details, //漏洞详情
                                    rank: item.rank, //漏洞等级
                                    url: item.url, //目标地址
                                    version: item.version, //版本
                                    timestamp: item.timestamp, //扫描到的时间
                                    suggest: item.suggest, //修复建议
                                };
                                this.LV = this.handleReturnSSR(item.rank);
                            });
                            break;
                        case 404:
                            this.$message.error("数据库GG了🐈");
                            break;
                        case 403:
                            this.$message.error("小宝贝这是非法查询哦(๑•̀ㅂ•́)و✧");
                            break;
                        case 169:
                            this.$message.error("莎酱被玩坏啦(>^ω^<)喵");
                            break;
                        case 500:
                            this.$message.error("请使用Post请求");
                            break;
                    }
                });
            } else if (this.$store.state.active_scan_id != "null") {
                this.$message.warning("请从漏洞列表查询进入,跳转漏洞列表查询中...");
                this.$router.push("/layout/siteInformation/siteScan");
            } else {
                this.$message.warning("请从站点扫描进入,跳转站点扫描中...");
                this.$router.push("/layout/siteInformation");
            }
        },
    },
};
</script>

<style lang="scss" scoped>
$background: #fff;
$color: #51c51a;

.vulnerabilityDetails {
    margin: 0;
    padding: 20px;
    padding-top: 15px;

    .vulnerabilityDetails-title {
        font-size: 18px;
        color: $color;
    }

    .vulnerabilityDetails-nav {

        min-width: 280px;
        padding: 10px;
        margin-top: 10px;
        margin-bottom: 10px;
        color: $color;
        border-radius: 15px;
        text-align: left;
        background: $background;
        font-size: 14px;

        .vulnerabilityDetails-nav-name {
            font-weight: 800;
            color: $color;
            font-size: 25px;
            border-bottom: 1px solid #ccc;
        }

        .vulnerabilityDetails-nav-best {
            color: $color;
            font-size: 18px;

            .format {
                margin-left: 10px;
                word-break: break-all;
                color: #000
            }

            .SSR {
                color: #ff6347;
                font-weight: 800;
            }

            .SR {
                color: #ff8000;
                font-weight: 800;
            }

            .UR {
                color: #03b7c9;
                font-weight: 800;
            }
        }

        .vulnerabilityDetails-nav-solution {
            color: $color;
            font-size: 18px;

            .class_title {
                border-left: 3px solid $color;
                padding-left: 5px;
                font-weight: 800;
            }

            .format {
                margin-top: 15px;
                margin-left: 10px;
                word-break: break-all;
                color: #000;
                background: rgb(245, 245, 245);
                border: 1px solid rgb(203, 203, 203);
                border-radius: 10px;
                padding: 5px;
            }

        }
    }
}
</style>
